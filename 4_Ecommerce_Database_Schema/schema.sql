-- Users
CREATE TABLE USERS (
  user_id     NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  email       VARCHAR2(255) UNIQUE NOT NULL,
  password    VARCHAR2(100) NOT NULL,
  full_name   VARCHAR2(200),
  created_at  TIMESTAMP DEFAULT SYSTIMESTAMP
);

-- Categories
CREATE TABLE CATEGORIES (
  category_id NUMBER GENERATED AS IDENTITY PRIMARY KEY,
  name        VARCHAR2(100) NOT NULL,
  parent_id   NUMBER REFERENCES CATEGORIES(category_id)
);

-- Products
CREATE TABLE PRODUCTS (
  product_id   NUMBER GENERATED AS IDENTITY PRIMARY KEY,
  name         VARCHAR2(200) NOT NULL,
  description  CLOB,
  price        NUMBER(10,2) NOT NULL,
  category_id  NUMBER NOT NULL REFERENCES CATEGORIES(category_id)
);

-- Inventory
CREATE TABLE INVENTORY (
  product_id  NUMBER PRIMARY KEY REFERENCES PRODUCTS(product_id),
  qty_on_hand NUMBER NOT NULL
);

-- Orders
CREATE TABLE ORDERS (
  order_id     NUMBER GENERATED AS IDENTITY PRIMARY KEY,
  user_id      NUMBER NOT NULL REFERENCES USERS(user_id),
  order_date   DATE DEFAULT SYSDATE NOT NULL,
  status       VARCHAR2(20) NOT NULL,
  total_amount NUMBER(12,2) NOT NULL
)
PARTITION BY RANGE (order_date)
(
  PARTITION p_2024_q1 VALUES LESS THAN (TO_DATE('2024-04-01','YYYY-MM-DD')),
  PARTITION p_2024_q2 VALUES LESS THAN (TO_DATE('2024-07-01','YYYY-MM-DD')),
  PARTITION p_2024_q3 VALUES LESS THAN (TO_DATE('2024-10-01','YYYY-MM-DD')),
  PARTITION p_2024_q4 VALUES LESS THAN (TO_DATE('2025-01-01','YYYY-MM-DD'))
);

-- Order Items
CREATE TABLE ORDER_ITEMS (
  order_item_id NUMBER GENERATED AS IDENTITY PRIMARY KEY,
  order_id      NUMBER NOT NULL REFERENCES ORDERS(order_id),
  product_id    NUMBER NOT NULL REFERENCES PRODUCTS(product_id),
  quantity      NUMBER(5) NOT NULL,
  unit_price    NUMBER(10,2) NOT NULL
);

-- Indexes
CREATE INDEX idx_orders_user_id ON ORDERS(user_id);
CREATE INDEX idx_order_items_order_id ON ORDER_ITEMS(order_id);
